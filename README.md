# Symfony OpenAPI Playground

## Development information

### Local development

#### Required softwares

- Make
- PHP (8.3)
- composer
- Java (dependency from `@openapitools/openapi-generator-cli`)
- Node
- podman-composea

#### Start the stack locally

1. Run `composer install`.
2. Run `npm install`.
3. Run `make api` to generate API's interface's code.
4. Run `make start` to start the containers.

You then need to jump into the PHP container by running `make jumpin`.
Once in the container you can then run the following commands:

1. Run `php bin/console lexik:jwt:generate-keypair` to generate SSL keys used to
   generate JSON Web Tokens.
2. Run `php bin/console doctrine:migrations:migrate` to migrate the database.
3. Run `php bin/console app:create-user <username> <password>` to create a user.

Once everything is setup you can access your containers on the following
adresses:

- API: <http://localhost:8000>
- Adminer: <http://localhost:8080>
- PostgreSQL: <localhost:5432>

If you are working on the OpenAPI specification or want to easily test the API,
you can run `make swagger-ui` to start Swagger UI on <http://localhost:8081>.


## Encountered Issues

## Podman usage and volumes mounting issue

- <https://www.tutorialworks.com/podman-rootless-volumes/>
- <https://www.redhat.com/sysadmin/rootless-podman-user-namespace-modes>
- <https://github.com/containers/podman-compose/issues/166>
- Fix postgresql permission issue: <https://stackoverflow.com/a/60194261>

## OpenAPI Generator to simplify implementation

- Really simple tutorial: <https://pguso.medium.com/openapi-generator-use-symfony-bundle-in-your-project-28034505548d>
- Convert old annotations generated by the generator into attributes: <https://www.dannyvankooten.com/blog/2023/rector-annotations-to-attributes/>
  - Makes the validators work again as Symfony 7 doesn't support annoations
    anymore. Thanks [Rector](https://github.com/rectorphp/rector) !
